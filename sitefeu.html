<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Défi : Feu</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body{
  background:black;
  color:white;
  font-family:'Press Start 2P', monospace;
  text-align:center;
  margin:0;
  padding:0;
}

h1{ margin-top:20px; font-size:14px; }

#score, #timer{
  margin-top:15px;
  font-size:14px;
}

#question{
  margin-top:40px;
  font-size:20px;
}

input{
  margin-top:20px;
  padding:10px;
  font-size:18px;
  width:150px;
  text-align:center;
  background:black;
  color:white;
  border:2px solid white;
}

#letterC{
  font-size:100px;
  margin-top:40px;
  display:none;
  animation:blink 1s infinite;
}

@keyframes blink{
  0%{opacity:1;}
  50%{opacity:0;}
  100%{opacity:1;}
}

.shake{
  animation:shake 0.3s;
}

@keyframes shake{
  0%{transform:translate(0,0);}
  25%{transform:translate(5px,-5px);}
  50%{transform:translate(-5px,5px);}
  75%{transform:translate(5px,5px);}
  100%{transform:translate(0,0);}
}
</style>
</head>

<body>

<h1>Défi Final : Calcul Mental</h1>

<div id="score">Score : 0 / 15</div>
<div id="timer">Temps : 20</div>
<div id="question"></div>
<input type="number" id="answer" autofocus>
<div id="letterC">C</div>

<script>
const questionEl = document.getElementById("question");
const answerInput = document.getElementById("answer");
const timerEl = document.getElementById("timer");
const scoreEl = document.getElementById("score");
const letterC = document.getElementById("letterC");
const body = document.body;

let questions = [];
let currentIndex = 0;
let score = 0;
let timeLeft = 20;
let interval;

// Calculs mentaux simples avec plus grand en premier
function generateQuestion(){
  const ops = ["+","-","*","/"];
  const op = ops[Math.floor(Math.random()*ops.length)];

  let a = Math.floor(Math.random()*10)+1;
  let b = Math.floor(Math.random()*9)+1;

  if(op === "/"){
    a = a * b; // division entière
  }

  // Toujours afficher le plus grand en premier
  if(b > a){
    [a,b] = [b,a];
  }

  let result;
  switch(op){
    case "+": result = a + b; break;
    case "-": result = a - b; break;
    case "*": result = a * b; break;
    case "/": result = a / b; break;
  }

  return { text:`${a} ${op} ${b}`, answer:result };
}

function initGame(){
  clearInterval(interval);

  questions = [];
  currentIndex = 0;
  score = 0;
  timeLeft = 20;
  letterC.style.display = "none";
  answerInput.value="";

  for(let i=0;i<14;i++){
    questions.push(generateQuestion());
  }

  questions.push({
    text:"on naît avec rien + on repart avec ...",
    answer:0
  });

  updateUI();
  startTimer();
  showQuestion();
}

function startTimer(){
  interval = setInterval(()=>{
    timeLeft--;
    timerEl.textContent = "Temps : " + timeLeft;

    if(timeLeft <= 0){
      initGame(); // reset UNIQUEMENT si timer = 0
    }
  },1000);
}

function updateUI(){
  scoreEl.textContent = "Score : " + score + " / 15";
  timerEl.textContent = "Temps : " + timeLeft;
}

function showQuestion(){
  questionEl.textContent = questions[currentIndex].text;
  answerInput.focus();
}

function shakeScreen(){
  body.classList.add("shake");
  setTimeout(()=> body.classList.remove("shake"),300);
}

answerInput.addEventListener("keydown", function(e){
  if(e.key === "Enter"){
    const userAnswer = Number(answerInput.value);

    if(userAnswer === questions[currentIndex].answer){

      score++;
      currentIndex++;
      timeLeft += 5; // bonus temps
      shakeScreen();
      answerInput.value="";
      updateUI();

      if(currentIndex >= questions.length){
        clearInterval(interval);
        letterC.style.display="block";
      }else{
        showQuestion();
      }

    }else{
      // Mauvaise réponse = on continue
      answerInput.value="";
    }
  }
});

initGame();
</script>

</body>
</html>
